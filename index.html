<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title id="page-title">Dhan App</title>
<link href="https://fonts.googleapis.com/css2?family=Nunito:wght@300;400;500;600;700;800&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
<style>
:root{--primary:#6C63FF;--primary-light:#a099ff;--primary-dark:#4a43cc;--accent:#FF6584;--bg:#F0F4FF;--surface:#fff;--surface2:#f7f8ff;--text:#2d2d3f;--text2:#6b6b8a;--border:#e2e6ff;--shadow:rgba(108,99,255,.12);--radius:18px;--radius-sm:10px;--transition:.3s cubic-bezier(.4,0,.2,1)}
[data-theme="ocean"]{--primary:#0077b6;--primary-light:#00b4d8;--primary-dark:#005f8a;--accent:#f77f00;--bg:#e8f4fd;--border:#cce7f5;--shadow:rgba(0,119,182,.12)}
[data-theme="forest"]{--primary:#2d6a4f;--primary-light:#52b788;--primary-dark:#1b4332;--accent:#d62828;--bg:#edf7ee;--border:#c8e6d0;--shadow:rgba(45,106,79,.12)}
[data-theme="sunset"]{--primary:#e76f51;--primary-light:#f4a261;--primary-dark:#c04a2e;--accent:#264653;--bg:#fff5f0;--border:#fdd5c6;--shadow:rgba(231,111,81,.12)}
[data-theme="midnight"]{--primary:#bb86fc;--primary-light:#d4a8ff;--primary-dark:#985eff;--accent:#03dac6;--bg:#121212;--surface:#1e1e2e;--surface2:#252535;--text:#e0e0f0;--text2:#9999bb;--border:#333355;--shadow:rgba(187,134,252,.15)}
[data-theme="rose"]{--primary:#c9184a;--primary-light:#ff4d6d;--primary-dark:#a4133c;--accent:#f77f00;--bg:#fff0f5;--border:#ffc8dd;--shadow:rgba(201,24,74,.12)}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Nunito',sans-serif;background:var(--bg);color:var(--text);min-height:100vh;transition:background var(--transition),color var(--transition)}
.app-wrapper{max-width:900px;margin:0 auto;padding:20px 16px 90px}
.app-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:28px;padding:18px 24px;background:var(--surface);border-radius:var(--radius);box-shadow:0 4px 24px var(--shadow);border:1px solid var(--border)}
.app-header h1{font-family:'Playfair Display',serif;font-size:1.6rem;color:var(--primary);letter-spacing:-.5px}
.user-badge{display:flex;align-items:center;gap:8px;font-weight:600;color:var(--text2);font-size:.9rem}
.avatar{width:38px;height:38px;background:linear-gradient(135deg,var(--primary),var(--accent));border-radius:50%;display:flex;align-items:center;justify-content:center;color:#fff;font-weight:800;font-size:.9rem}
.sync-indicator{display:flex;align-items:center;gap:5px}
#sync-dot{width:8px;height:8px;border-radius:50%;background:#94a3b8;transition:background .3s;flex-shrink:0}
#sync-text{font-size:.7rem;color:var(--text2);min-width:0}
.card{background:var(--surface);border-radius:var(--radius);box-shadow:0 4px 24px var(--shadow);border:1px solid var(--border);overflow:hidden;animation:fadeUp .4s ease both}
@keyframes fadeUp{from{opacity:0;transform:translateY(16px)}to{opacity:1;transform:translateY(0)}}
.bottom-nav{position:fixed;bottom:0;left:0;right:0;background:var(--surface);border-top:1px solid var(--border);display:flex;justify-content:space-around;padding:10px 0 14px;box-shadow:0 -4px 24px var(--shadow);z-index:100;overflow-x:auto}
.nav-item{display:flex;flex-direction:column;align-items:center;gap:4px;cursor:pointer;padding:6px 12px;border-radius:var(--radius-sm);transition:var(--transition);color:var(--text2);font-size:.7rem;font-weight:600;border:none;background:none;white-space:nowrap}
.nav-item.active{color:var(--primary)}
.nav-item .nav-icon{font-size:1.3rem;transition:var(--transition)}
.nav-item.active .nav-icon{transform:scale(1.15)}
.page{display:none}.page.active{display:block}
.cal-header{display:flex;align-items:center;justify-content:space-between;padding:20px 24px 16px;border-bottom:1px solid var(--border)}
.cal-header h2{font-size:1.2rem;font-weight:700;color:var(--primary)}
.cal-nav{display:flex;gap:8px}
.cal-nav button{background:var(--surface2);border:1px solid var(--border);color:var(--text);border-radius:8px;padding:6px 12px;cursor:pointer;font-weight:700;font-size:1rem;transition:var(--transition)}
.cal-nav button:hover{background:var(--primary);color:#fff;border-color:var(--primary)}
.cal-body{padding:20px 24px}
.cal-days-header{display:grid;grid-template-columns:repeat(7,1fr);text-align:center;margin-bottom:10px}
.cal-days-header span{font-size:.75rem;font-weight:700;color:var(--text2);padding:4px 0}
.cal-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:4px}
.cal-day{aspect-ratio:1;display:flex;align-items:center;justify-content:center;border-radius:10px;cursor:pointer;font-weight:600;font-size:.88rem;transition:var(--transition);position:relative}
.cal-day:hover{background:var(--surface2)}
.cal-day.other-month{color:var(--border)}
.cal-day.today{background:var(--primary);color:#fff;box-shadow:0 4px 12px var(--shadow)}
.cal-day.selected{background:var(--accent);color:#fff}
.cal-day.has-event::after{content:'';position:absolute;bottom:3px;width:5px;height:5px;border-radius:50%;background:var(--accent)}
.cal-day.today::after{background:#fff}
.cal-events{margin-top:20px;padding-top:16px;border-top:1px solid var(--border)}
.cal-events h3{font-size:.9rem;color:var(--text2);margin-bottom:12px;font-weight:700}
.event-input-row{display:flex;gap:8px;margin-bottom:12px}
.event-input-row input{flex:1;padding:10px 14px;border-radius:var(--radius-sm);border:1.5px solid var(--border);background:var(--surface2);color:var(--text);font-family:inherit;font-size:.88rem;outline:none;transition:var(--transition)}
.event-input-row input:focus{border-color:var(--primary)}
.btn{padding:10px 18px;border-radius:var(--radius-sm);border:none;background:var(--primary);color:#fff;font-family:inherit;font-weight:700;font-size:.88rem;cursor:pointer;transition:var(--transition);white-space:nowrap}
.btn:hover{background:var(--primary-dark);transform:translateY(-1px)}
.btn-sm{padding:6px 12px;font-size:.8rem}
.btn-danger{background:var(--accent)}
.btn-danger:hover{background:#cc3a5a}
.btn-ghost{background:var(--surface2);color:var(--text);border:1px solid var(--border)}
.btn-ghost:hover{background:var(--surface);border-color:var(--primary);color:var(--primary);transform:translateY(-1px)}
.event-list{display:flex;flex-direction:column;gap:8px;max-height:180px;overflow-y:auto}
.event-item{display:flex;align-items:center;justify-content:space-between;padding:10px 14px;background:var(--surface2);border-radius:var(--radius-sm);border:1px solid var(--border)}
.event-item span{font-size:.85rem;font-weight:600}
.event-date{font-size:.75rem;color:var(--text2);margin-left:8px}
.section-pad{padding:24px}
.section-title{font-size:1.1rem;font-weight:800;color:var(--primary);margin-bottom:20px;display:flex;align-items:center;gap:8px}
.input-group{margin-bottom:16px}
.input-label{font-size:.8rem;font-weight:700;color:var(--text2);margin-bottom:6px;display:block}
.input-row{display:flex;gap:10px}
.styled-input{width:100%;padding:12px 16px;border-radius:var(--radius-sm);border:1.5px solid var(--border);background:var(--surface2);color:var(--text);font-family:inherit;font-size:1rem;outline:none;transition:var(--transition)}
.styled-input:focus{border-color:var(--primary);box-shadow:0 0 0 3px rgba(108,99,255,.1)}
.styled-select{padding:12px 16px;border-radius:var(--radius-sm);border:1.5px solid var(--border);background:var(--surface2);color:var(--text);font-family:inherit;font-size:.9rem;outline:none;transition:var(--transition);cursor:pointer;min-width:100px}
.styled-select:focus{border-color:var(--primary)}
.swap-btn{background:var(--primary);color:#fff;border:none;border-radius:50%;width:44px;height:44px;font-size:1.3rem;cursor:pointer;transition:var(--transition);display:flex;align-items:center;justify-content:center;flex-shrink:0;align-self:flex-end;margin-bottom:2px}
.swap-btn:hover{background:var(--primary-dark);transform:rotate(180deg)}
.result-box{background:linear-gradient(135deg,var(--primary),var(--primary-light));color:#fff;border-radius:var(--radius);padding:20px 24px;text-align:center;margin-top:16px}
.result-box .result-value{font-size:2rem;font-weight:800}
.result-box .result-label{font-size:.85rem;opacity:.85;margin-top:4px}
.rate-info{font-size:.75rem;opacity:.7;margin-top:8px}
.quick-rates{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-top:20px}
.rate-card{background:var(--surface2);border:1px solid var(--border);border-radius:var(--radius-sm);padding:12px;text-align:center;cursor:pointer;transition:var(--transition)}
.rate-card:hover{border-color:var(--primary);background:var(--surface)}
.rate-card .flag{font-size:1.4rem}
.rate-card .code{font-size:.75rem;font-weight:700;color:var(--text2);margin-top:4px}
.rate-card .val{font-size:.9rem;font-weight:800;color:var(--primary)}
.calc-wrapper{padding:24px;max-width:360px;margin:0 auto}
.calc-display{background:linear-gradient(135deg,var(--primary-dark),var(--primary));border-radius:var(--radius);padding:20px 24px;margin-bottom:16px;color:#fff;text-align:right;min-height:90px;display:flex;flex-direction:column;justify-content:flex-end;box-shadow:0 8px 24px var(--shadow)}
.calc-expr{font-size:.85rem;opacity:.7;min-height:20px}
.calc-result{font-size:2.4rem;font-weight:800;line-height:1.1;word-break:break-all}
.calc-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:10px}
.calc-btn{padding:18px;border:none;border-radius:var(--radius-sm);font-family:inherit;font-size:1.05rem;font-weight:700;cursor:pointer;transition:var(--transition);background:var(--surface2);color:var(--text);border:1.5px solid var(--border);aspect-ratio:1}
.calc-btn:hover{transform:scale(1.05)}
.calc-btn:active{transform:scale(.97)}
.calc-btn.op{background:var(--surface);color:var(--primary);border-color:var(--primary-light)}
.calc-btn.eq{background:var(--primary);color:#fff;border-color:var(--primary)}
.calc-btn.eq:hover{background:var(--primary-dark)}
.calc-btn.clear{background:var(--accent);color:#fff;border-color:var(--accent)}
.calc-btn.zero{grid-column:span 2;aspect-ratio:auto}
.settings-section{padding:24px}
.settings-group{margin-bottom:28px}
.settings-group-title{font-size:.78rem;font-weight:800;color:var(--text2);text-transform:uppercase;letter-spacing:1.2px;margin-bottom:14px;padding-bottom:8px;border-bottom:1px solid var(--border)}
.settings-row{display:flex;align-items:center;justify-content:space-between;padding:14px 0;border-bottom:1px solid var(--border)}
.settings-row:last-child{border-bottom:none}
.settings-row-label{font-weight:600;font-size:.92rem}
.settings-row-desc{font-size:.78rem;color:var(--text2);margin-top:2px}
.settings-row-control{flex-shrink:0;margin-left:16px}
.theme-grid{display:grid;grid-template-columns:repeat(6,1fr);gap:10px;margin-top:12px}
.theme-swatch{height:42px;border-radius:var(--radius-sm);cursor:pointer;border:3px solid transparent;transition:var(--transition);position:relative}
.theme-swatch:hover{transform:scale(1.08)}
.theme-swatch.active{border-color:var(--text);box-shadow:0 4px 12px var(--shadow)}
.theme-swatch.active::after{content:'ok';position:absolute;inset:0;display:flex;align-items:center;justify-content:center;color:#fff;font-size:.65rem;font-weight:800;text-shadow:0 1px 3px rgba(0,0,0,.4)}
.settings-input-full{width:100%;padding:10px 14px;border-radius:var(--radius-sm);border:1.5px solid var(--border);background:var(--surface2);color:var(--text);font-family:inherit;font-size:.92rem;outline:none;transition:var(--transition)}
.settings-input-full:focus{border-color:var(--primary)}
.toggle{position:relative;width:48px;height:26px}
.toggle input{opacity:0;width:0;height:0}
.toggle-slider{position:absolute;inset:0;background:var(--border);border-radius:26px;cursor:pointer;transition:var(--transition)}
.toggle-slider::before{content:'';position:absolute;left:3px;top:3px;width:20px;height:20px;background:#fff;border-radius:50%;transition:var(--transition)}
.toggle input:checked + .toggle-slider{background:var(--primary)}
.toggle input:checked + .toggle-slider::before{transform:translateX(22px)}
.updater-box{border:2px dashed var(--border);border-radius:var(--radius);padding:36px 24px;text-align:center;cursor:pointer;transition:var(--transition);margin-bottom:20px}
.updater-box:hover,.updater-box.dragover{border-color:var(--primary);background:var(--surface2)}
.updater-icon{font-size:2.5rem;margin-bottom:12px}
.updater-title{font-weight:800;font-size:1rem;color:var(--primary)}
.updater-sub{font-size:.82rem;color:var(--text2);margin-top:6px}
#dhan-file-input{display:none}
.update-log{background:var(--surface2);border:1px solid var(--border);border-radius:var(--radius-sm);padding:16px;font-family:'Courier New',monospace;font-size:.78rem;max-height:220px;overflow-y:auto;color:var(--text2)}
.update-log .log-line{margin-bottom:3px}
.update-log .log-ok{color:#22c55e}
.update-log .log-err{color:var(--accent)}
.update-log .log-info{color:var(--primary)}
.patch-list{display:flex;flex-direction:column;gap:8px;margin-top:12px;max-height:160px;overflow-y:auto}
.patch-item{display:flex;align-items:center;justify-content:space-between;padding:8px 12px;background:var(--surface2);border-radius:var(--radius-sm);border:1px solid var(--border);font-size:.8rem}
.patch-item .patch-name{font-weight:700;color:var(--primary)}
.patch-item .patch-time{color:var(--text2);font-size:.72rem}
.supabase-status-box{margin-top:16px;padding:14px;background:var(--surface2);border-radius:var(--radius-sm);border:1px solid var(--border)}
.sb-status-row{display:flex;align-items:center;gap:8px;font-size:.82rem;margin-bottom:6px}
#sb-dot{width:10px;height:10px;border-radius:50%;background:#94a3b8;flex-shrink:0;transition:background .3s}
.toast{position:fixed;top:20px;right:20px;z-index:9999;background:var(--primary);color:#fff;padding:14px 20px;border-radius:var(--radius-sm);font-weight:700;font-size:.88rem;box-shadow:0 8px 24px var(--shadow);transform:translateX(110%);transition:transform .4s cubic-bezier(.4,0,.2,1);max-width:280px}
.toast.show{transform:translateX(0)}
.toast.error{background:var(--accent)}
::-webkit-scrollbar{width:5px;height:5px}
::-webkit-scrollbar-track{background:transparent}
::-webkit-scrollbar-thumb{background:var(--border);border-radius:10px}
</style>
</head>
<body>
<div class="app-wrapper">
  <div class="app-header">
    <h1 id="app-title-display">Dhan App</h1>
    <div class="user-badge">
      <div class="sync-indicator">
        <span id="sync-dot"></span>
        <span id="sync-text"></span>
      </div>
      <span id="header-username">Pengguna</span>
      <div class="avatar" id="header-avatar">D</div>
    </div>
  </div>

  <!-- CALENDAR -->
  <div class="page active card" id="page-calendar">
    <div class="cal-header">
      <h2 id="cal-month-year">Januari 2024</h2>
      <div class="cal-nav">
        <button onclick="changeMonth(-1)">&#8249;</button>
        <button onclick="goToday()">Hari Ini</button>
        <button onclick="changeMonth(1)">&#8250;</button>
      </div>
    </div>
    <div class="cal-body">
      <div class="cal-days-header"><span>Min</span><span>Sen</span><span>Sel</span><span>Rab</span><span>Kam</span><span>Jum</span><span>Sab</span></div>
      <div class="cal-grid" id="cal-grid"></div>
      <div class="cal-events">
        <h3>&#128205; Catatan / Event</h3>
        <div class="event-input-row">
          <input type="text" id="event-input" placeholder="Tambah catatan untuk tanggal terpilih..."/>
          <button class="btn" onclick="addEvent()">+ Tambah</button>
        </div>
        <div class="event-list" id="event-list"></div>
      </div>
    </div>
  </div>

  <!-- CURRENCY -->
  <div class="page card" id="page-currency">
    <div class="section-pad">
      <div class="section-title">&#128178; Konverter Mata Uang</div>
      <div class="input-group">
        <label class="input-label">Jumlah</label>
        <input type="number" id="curr-amount" class="styled-input" value="1" oninput="convertCurrency()"/>
      </div>
      <div class="input-row" style="align-items:flex-end;gap:10px">
        <div style="flex:1"><label class="input-label">Dari</label><select id="curr-from" class="styled-select" style="width:100%" onchange="convertCurrency()"></select></div>
        <button class="swap-btn" onclick="swapCurrencies()" title="Tukar">&#8644;</button>
        <div style="flex:1"><label class="input-label">Ke</label><select id="curr-to" class="styled-select" style="width:100%" onchange="convertCurrency()"></select></div>
      </div>
      <div class="result-box" id="curr-result">
        <div class="result-value" id="curr-result-val">&#8212;</div>
        <div class="result-label" id="curr-result-label">Masukkan jumlah untuk konversi</div>
        <div class="rate-info" id="curr-rate-info"></div>
      </div>
      <div style="margin-top:20px"><label class="input-label">&#9889; Kurs Populer vs IDR</label><div class="quick-rates" id="quick-rates"></div></div>
    </div>
  </div>

  <!-- CALCULATOR -->
  <div class="page card" id="page-calculator">
    <div class="calc-wrapper">
      <div class="section-title">&#129518; Kalkulator</div>
      <div class="calc-display">
        <div class="calc-expr" id="calc-expr"></div>
        <div class="calc-result" id="calc-display">0</div>
      </div>
      <div class="calc-grid">
        <button class="calc-btn clear" onclick="calcClear()">AC</button>
        <button class="calc-btn op" onclick="calcSign()">+/-</button>
        <button class="calc-btn op" onclick="calcPercent()">%</button>
        <button class="calc-btn op" onclick="calcInput('/')">&#247;</button>
        <button class="calc-btn" onclick="calcInput('7')">7</button>
        <button class="calc-btn" onclick="calcInput('8')">8</button>
        <button class="calc-btn" onclick="calcInput('9')">9</button>
        <button class="calc-btn op" onclick="calcInput('*')">&#215;</button>
        <button class="calc-btn" onclick="calcInput('4')">4</button>
        <button class="calc-btn" onclick="calcInput('5')">5</button>
        <button class="calc-btn" onclick="calcInput('6')">6</button>
        <button class="calc-btn op" onclick="calcInput('-')">&#8722;</button>
        <button class="calc-btn" onclick="calcInput('1')">1</button>
        <button class="calc-btn" onclick="calcInput('2')">2</button>
        <button class="calc-btn" onclick="calcInput('3')">3</button>
        <button class="calc-btn op" onclick="calcInput('+')">+</button>
        <button class="calc-btn zero" onclick="calcInput('0')">0</button>
        <button class="calc-btn" onclick="calcDot()">.</button>
        <button class="calc-btn eq" onclick="calcEquals()">=</button>
      </div>
      <div style="margin-top:16px;text-align:center;color:var(--text2);font-size:.78rem">Riwayat: <span id="calc-history" style="color:var(--text)">&#8212;</span></div>
    </div>
  </div>

  <!-- SETTINGS -->
  <div class="page card" id="page-settings">
    <div class="settings-section">
      <div class="settings-group">
        <div class="settings-group-title">&#128100; Profil</div>
        <div class="settings-row">
          <div><div class="settings-row-label">Nama Pengguna</div><div class="settings-row-desc">Tampil di header</div></div>
          <div class="settings-row-control"><input type="text" id="setting-name" class="settings-input-full" style="width:160px" placeholder="Nama kamu" value="Pengguna" oninput="updateProfile()"/></div>
        </div>
        <div class="settings-row">
          <div><div class="settings-row-label">Judul Aplikasi</div><div class="settings-row-desc">Nama app di header &amp; tab browser</div></div>
          <div class="settings-row-control"><input type="text" id="setting-apptitle" class="settings-input-full" style="width:160px" placeholder="Nama Aplikasi" value="Dhan App" oninput="updateAppTitle()"/></div>
        </div>
      </div>
      <div class="settings-group">
        <div class="settings-group-title">&#127912; Tema Warna</div>
        <div class="theme-grid" id="theme-grid">
          <div class="theme-swatch active" da
